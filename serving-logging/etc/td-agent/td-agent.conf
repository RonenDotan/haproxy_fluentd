####
## Output descriptions:
##

# Treasure Data (http://www.treasure-data.com/) provides cloud based data
# analytics platform, which easily stores and processes data from td-agent.
# FREE plan is also provided.
# @see http://docs.fluentd.org/articles/http-to-td
#
# This section matches events whose tag is td.DATABASE.TABLE
#<match td.*.*>
#  @type tdlog
#  @id output_td
#  apikey YOUR_API_KEY

#  auto_create_table
#  <buffer>
#    @type file
#    path /var/log/td-agent/buffer/td
#  </buffer>

#  <secondary>
#    @type file
#    path /var/log/td-agent/failed_records
#  </secondary>
#</match>

<source>
  @type syslog
  port 5140
  tag new_serving_syslog
</source>


# https://docs.fluentd.org/how-to-guides/parse-syslog#step-3-extract-information-from-messages
#
<filter new_serving_syslog.**>
  @type grep
  <exclude>
    key message
    pattern repeated|WARNING|ALERT
  </exclude>
</filter>


<filter new_serving_syslog.**>
  @type parser
  key_name message
  reserve_data false
  format json
</filter>

<match new_serving_syslog.**>
  @type bigquery
  method load
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json

  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_new_serving
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1h
  </buffer>

  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_%H
  #table yourtable%{time_slice}
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

# For Debug Purposes
#<match new_serving_syslog.**>
#  @type stdout
#  @id output_stdout_new_serving_syslog
#</match>


## match tag=debug.** and dump to console
<match debug.**>
  @type stdout
  @id output_stdout
</match>

####
## Source descriptions:
##

## built-in TCP input
## @see http://docs.fluentd.org/articles/in_forward
<source>
  @type forward
  @id input_forward
</source>

## built-in UNIX socket input
#<source>
#  type unix
#</source>

# HTTP input
# POST http://localhost:8888/<tag>?json=<json>
# POST http://localhost:8888/td.myapp.login?json={"user"%3A"me"}
# @see http://docs.fluentd.org/articles/in_http
<source>
  @type http
  @id input_http
  port 8888
</source>

<source>
  @type http
  @id input_http2
  port 8080
</source>

# PHP input
# https://docs.fluentd.org/v1.0/articles/php
<source>
  @type forward
  port 24225
</source>

<source>
  @type forward
  port 24226
</source>

<source>
  @type forward
  port 24227
</source>

<source>
  @type forward
  port 24228
</source>

<source>
  @type forward
  port 24229
</source>

<source>
  @type forward
  port 24230
</source>



## live debugging agent
#<source>
#  @type debug_agent
#  @id input_debug_agent
#  bind 127.0.0.1
#  port 24230
#</source>

####
## Examples:
##

## File input
## read apache logs continuously and tags td.apache.access
#<source>
#  @type tail
#  @id input_tail
#  <parse>
#    @type apache2
#  </parse>
#  path /var/log/httpd-access.log
#  tag td.apache.access
#</source>

## File output
## match tag=local.** and write to file
<match local.**>
  @type file
  @id output_file
  path /var/log/td-agent/access
</match>

## Forwarding
## match tag=system.** and forward to another td-agent server
#<match system.**>
#  @type forward
#  @id output_system_forward
#
#  <server>
#    host 192.168.0.11
#  </server>
#  # secondary host is optional
#  <secondary>
#    <server>
#      host 192.168.0.12
#    </server>
#  </secondary>
#</match>

## Multiple output
## match tag=td.*.* and output to Treasure Data AND file
#<match td.*.*>
#  @type copy
#  @id output_copy
#  <store>
#    @type tdlog
#    apikey API_KEY
#    auto_create_table
#    <buffer>
#      @type file
#      path /var/log/td-agent/buffer/td
#    </buffer>
#  </store>
#  <store>
#    @type file
#    path /var/log/td-agent/td-%Y-%m-%d/%H.log
#  </store>
#</match>

###########################################################################
##                                                      SERVING LOGS SECTION                                     ##
###########################################################################
<match big_query.serving_logs>
  @type bigquery

  method load

  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqservlog
  flush_interval 5s
  time_slice_format %Y%m%d
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>

  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json

  project adserver-190515
  dataset serving_logs
  auto_create_table true
  table log%Y%m%d
  add_insert_timestamp time_t

  schema [
    {"name": "timestamp",                                                                               "type": "TIMESTAMP"},
    {"name": "entity_type_id",                                                                  "type": "INTEGER"},
    {"name": "unique_id",                                                                               "type": "STRING"},
    {"name": "f_int1",                                                                                  "type": "INTEGER"},
    {"name": "f_int2",                                                                                  "type": "INTEGER"},
    {"name": "f_float",                                                                                 "type": "FLOAT"},
    {"name": "f_str1",                                                                                  "type": "STRING"},
    {"name": "f_str2",                                                                                  "type": "STRING"},
    {"name": "f_str3",                                                                                  "type": "STRING"},
    {"name": "f_date1",                                                                                 "type": "STRING"},
    {"name": "f_date1",                                                                                 "type": "DATE"},
    {"name": "f_date2",                                                                                 "type": "DATE"},
    {"name": "datetime1",                                                                               "type": "TIMESTAMP"},
    {"name": "datetime2",                                                                               "type": "TIMESTAMP"},
    {"name": "text",                                                                                    "type": "STRING"},
    {"name": "text2",                                                                                   "type": "STRING"}
   ]
</match>







###########################################################################
##                                                      VIEWS SECTION                                                    ##
###########################################################################
<match big_query.views_00>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_00
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_00
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_01>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_01
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_01
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_02>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_02
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_02
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_03>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_03
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_03
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_04>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_04
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_04
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_05>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_05
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_05
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_06>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_06
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_06
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_07>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_07
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_07
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_08>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_08
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_08
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_09>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_09
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_09
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_10>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_10
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_10
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_11>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_11
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_11
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_12>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_12
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_12
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_13>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_13
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_13
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_14>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_14
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_14
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_15>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_15
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_15
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_16>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_16
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_16
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_17>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_17
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_17
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_18>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_18
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_18
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_19>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_19
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_19
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_20>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_20
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_20
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_21>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_21
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_21
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_22>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_22
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_22
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>

<match big_query.views_23>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqviews_23
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset views
  auto_create_table true
  table log%Y%m%d_23
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_views.schema
</match>





















###########################################################################
##                                                      CLICKS SECTION                                                   ##
###########################################################################
<match big_query.clicks_00>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_00
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_00
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_01>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_01
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_01
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_02>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_02
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_02
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_03>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_03
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_03
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_04>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_04
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_04
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_05>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_05
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_05
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_06>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_06
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_06
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_07>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_07
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_07
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_08>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_08
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_08
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_09>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_09
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_09
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_10>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_10
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_10
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_11>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_11
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_11
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_12>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_12
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_12
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_13>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_13
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_13
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_14>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_14
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_14
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_15>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_15
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_15
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_16>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_16
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_16
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_17>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_17
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_17
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_18>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_18
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_18
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_19>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_19
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_19
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_20>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_20
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_20
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_21>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_21
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_21
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_22>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_22
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_22
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_23>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_23
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks
  auto_create_table true
  table log%Y%m%d_23
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>





<match big_query.clicks_eu_00>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_00
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_00
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_01>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_01
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_01
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_02>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_02
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_02
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_03>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_03
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_03
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_04>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_04
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_04
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_05>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_05
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_05
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_06>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_06
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_06
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_07>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_07
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_07
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_08>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_08
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_08
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_09>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_09
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_09
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_10>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_10
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_10
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_11>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_11
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_11
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_12>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_12
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_12
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_13>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_13
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_13
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_14>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_14
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_14
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_15>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_15
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_15
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_16>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_16
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_16
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_17>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_17
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_17
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_18>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_18
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_18
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_19>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_19
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_19
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_20>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_20
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_20
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_21>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_21
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_21
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_22>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_22
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_22
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

<match big_query.clicks_eu_23>
  @type bigquery
  method load
  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqclicks_eu_23
  flush_interval 600s
  flush_at_shutdown true
  slow_flush_log_threshold 50.0
  timekey 1d
  </buffer>
  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json
  project adserver-190515
  dataset clicks_eu
  auto_create_table true
  table log%Y%m%d_23
  add_insert_timestamp time_t
  schema_path /etc/td-agent/schemas/bq_clicks.schema
</match>

























###########################################################################
##                                                      CONVS SECTION                                                    ##
###########################################################################

<match mysql_adserver.conversions>
  @type mysql_bulk
  host 10.132.20.240
  database adserver
  username adserver
  password 20160328mord
  column_names click_id,client_id,payout,additional_data
  table conversions
  flush_interval 600s
  retry_limit 3
  retry_wait 1s
  max_retry_wait 20s
  buffer_type file
  buffer_path /var/log/td-agent/buffer/convs*.buffer
  <secondary>
    @type file
    path /var/log/td-agent/failed_records/convs_errors
    append true
    format json
  </secondary>
</match>

<match big_query.conversions>
  @type bigquery

  method load

  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqconvs
  flush_interval 600s
  time_slice_format %Y%m%d
  flush_at_shutdown true
  timekey 1d
  </buffer>


  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json

  project adserver-190515
  dataset conversions
  auto_create_table true
  table log%Y%m%d
  add_insert_timestamp time_t


  # click_id,view_id,conversion_time,click_time,product_id,is_redirect,advertiser_id,is_cookie,
  # publisher_id,country,city,asn,ua,device_id,sub_id1,sub_id2,param1,param2,param3,param4,domain,
  # ip,browser_id,creative_id,os,os_version,device_brand,device_model,conn_type,link_type,link_id,
  # tag_id,sl_rule_id,group_num,is_bot,redirect,user_id,finger_print_id,fraud_score,additional_data,
  # client_id,payout
  schema [
    {"name": "click_id",                                                                                "type": "STRING"},
    {"name": "view_id",                                                                                 "type": "STRING"},
        {"name": "conversion_time",                                                             "type": "TIMESTAMP"},
        {"name": "click_time",                                                                          "type": "TIMESTAMP"},
        {"name": "product_id",                                                                          "type": "INTEGER"},
        {"name": "is_redirect",                                                                         "type": "INTEGER"},
    {"name": "advertiser_id",                                                                   "type": "INTEGER"},
    {"name": "is_cookie",                                                                               "type": "INTEGER"},
    {"name": "publisher_id",                                                                    "type": "INTEGER"},
        {"name": "country",                                                                             "type": "STRING"},
        {"name": "city",                                                                                        "type": "STRING"},
        {"name": "asn",                                                                                         "type": "INTEGER"},
    {"name": "ua",                                                                                              "type": "STRING"},
        {"name": "device_id",                                                                           "type": "STRING"},
    {"name": "sub_id1",                                                                                 "type": "STRING"},
        {"name": "sub_id2",                                                                             "type": "STRING"},
    {"name": "param1",                                                                                  "type": "STRING"},
        {"name": "param2",                                                                                      "type": "STRING"},
        {"name": "param3",                                                                                      "type": "STRING"},
        {"name": "param4",                                                                                      "type": "STRING"},
    {"name": "domain",                                                                                  "type": "STRING"},
        {"name": "ip",                                                                                          "type": "STRING"},
    {"name": "browser_id",                                                                              "type": "STRING"},
        {"name": "creative_id",                                                                         "type": "INTEGER"},
    {"name": "os",                                                                                              "type": "STRING"},
        {"name": "os_version",                                                                          "type": "STRING"},
        {"name": "device_brand",                                                                        "type": "STRING"},
        {"name": "device_model",                                                                        "type": "INTEGER"},
    {"name": "conn_type",                                                                               "type": "INTEGER"},
        {"name": "link_type",                                                                           "type": "INTEGER"},
    {"name": "link_id",                                                                                 "type": "INTEGER"},
    {"name": "tag_id",                                                                                  "type": "INTEGER"},
    {"name": "sl_rule_id",                                                                              "type": "INTEGER"},
    {"name": "group_num",                                                                               "type": "FLOAT"},
    {"name": "is_bot",                                                                                  "type": "INTEGER"},
        {"name": "redirect",                                                                            "type": "INTEGER"},
        {"name": "user_id",                                                                             "type": "STRING"},
        {"name": "finger_print_id",                                                             "type": "STRING"},
    {"name": "fraud_score",                                                                     "type": "FLOAT"},
    {"name": "additional_data",                                                                 "type": "STRING"},
    {"name": "fake_sub_id",                                                                     "type": "STRING"},
    {"name": "fake_sub_id2",                                                                    "type": "STRING"},
    {"name": "fake_sub_id3",                                                                    "type": "STRING"},
    {"name": "fake_sub_id4",                                                                    "type": "STRING"},
    {"name": "fake_app_name",                                                                   "type": "STRING"},
    {"name": "fake_app_code",                                                                   "type": "STRING"},
    {"name": "client_id",                                                                               "type": "INTEGER"},
    {"name": "payout",                                                                                  "type": "FLOAT"}
        ]
</match>









###########################################################################
##                                                      LTVS SECTION                                                     ##
###########################################################################

<match mysql_adserver.ltvs>
  @type mysql_bulk
  host 10.132.20.240
  database adserver
  username adserver
  password 20160328mord
  column_names click_id,client_id,payout,additional_data, ltv_event_id,ltv_event_text
  table ltvs
  flush_interval 600s
  retry_limit 3
  retry_wait 1s
  max_retry_wait 20s
  buffer_type file
  buffer_path /var/log/td-agent/buffer/ltvs*.buffer
  <secondary>
    @type file
    path /var/log/td-agent/failed_records/ltvs_errors
    append true
    format json
  </secondary>
</match>





<match big_query.ltvs_raw>
  @type bigquery

  method load

  <buffer time>
  @type file
  path /var/log/td-agent/buffer/td-bqltvsraw
  flush_interval 600s
  time_slice_format %Y%m%d
  flush_at_shutdown true
  timekey 1d
  </buffer>


  auth_method json_key   # default
  json_key /var/www/html/php/general/adserver-41b51f319c90.json

  project adserver-190515
  dataset ltvs_raw
  auto_create_table true
  table log%Y%m%d
  add_insert_timestamp time_t


  schema [
    {"name": "click_id",                                                                                "type": "STRING"},
    {"name": "view_id",                                                                                 "type": "STRING"},
    {"name": "conversion_id",                                                                   "type": "INTEGER"},
        {"name": "conversion_time",                                                             "type": "TIMESTAMP"},
        {"name": "ltv_time",                                                                            "type": "TIMESTAMP"},
        {"name": "click_time",                                                                          "type": "TIMESTAMP"},
        {"name": "ltv_event_id",                                                                        "type": "INTEGER"},
    {"name": "ltv_event_text",                                                                  "type": "STRING"},
        {"name": "product_id",                                                                          "type": "INTEGER"},
        {"name": "is_redirect",                                                                         "type": "INTEGER"},
    {"name": "advertiser_id",                                                                   "type": "INTEGER"},
    {"name": "is_cookie",                                                                               "type": "INTEGER"},
    {"name": "publisher_id",                                                                    "type": "INTEGER"},
        {"name": "country",                                                                             "type": "STRING"},
        {"name": "city",                                                                                        "type": "STRING"},
        {"name": "asn",                                                                                         "type": "INTEGER"},
    {"name": "ua",                                                                                              "type": "STRING"},
        {"name": "device_id",                                                                           "type": "STRING"},
    {"name": "sub_id1",                                                                                 "type": "STRING"},
        {"name": "sub_id2",                                                                             "type": "STRING"},
    {"name": "param1",                                                                                  "type": "STRING"},
        {"name": "param2",                                                                                      "type": "STRING"},
        {"name": "param3",                                                                                      "type": "STRING"},
        {"name": "param4",                                                                                      "type": "STRING"},
    {"name": "domain",                                                                                  "type": "STRING"},
        {"name": "ip",                                                                                          "type": "STRING"},
    {"name": "browser_id",                                                                              "type": "STRING"},
        {"name": "creative_id",                                                                         "type": "INTEGER"},
    {"name": "os",                                                                                              "type": "STRING"},
        {"name": "os_version",                                                                          "type": "STRING"},
        {"name": "device_brand",                                                                        "type": "STRING"},
        {"name": "device_model",                                                                        "type": "INTEGER"},
    {"name": "conn_type",                                                                               "type": "INTEGER"},
        {"name": "link_type",                                                                           "type": "INTEGER"},
    {"name": "link_id",                                                                                 "type": "INTEGER"},
    {"name": "tag_id",                                                                                  "type": "INTEGER"},
    {"name": "sl_rule_id",                                                                              "type": "INTEGER"},
    {"name": "group_num",                                                                               "type": "FLOAT"},
    {"name": "is_bot",                                                                                  "type": "INTEGER"},
        {"name": "redirect",                                                                            "type": "INTEGER"},
        {"name": "user_id",                                                                             "type": "STRING"},
        {"name": "finger_print_id",                                                             "type": "STRING"},
    {"name": "fraud_score",                                                                     "type": "FLOAT"},
    {"name": "additional_data",                                                                 "type": "STRING"},
    {"name": "client_id",                                                                               "type": "INTEGER"},
    {"name": "payout",                                                                                  "type": "FLOAT"}
        ]
</match>
